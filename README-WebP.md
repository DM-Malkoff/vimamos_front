# WebP Оптимизация в Next.js

## 🚀 Что было настроено

### 1. Конфигурация Next.js (`next.config.js`)
- ✅ Автоматическая конвертация в WebP
- ✅ Адаптивные размеры изображений
- ✅ Кеширование изображений на 1 год
- ✅ HTTP заголовки для оптимизации

### 2. Компоненты изображений
- ✅ Оптимизированы все `Image` компоненты
- ✅ Добавлены placeholder'ы с shimmer эффектом
- ✅ Настроены правильные `sizes` атрибуты
- ✅ Установлены priority для важных изображений

### 3. Качество изображений (`constants/config.js`)
```javascript
const imageQuality = {
    high: 90,     // Для страниц товаров
    normal: 75,   // Для каталога
    low: 60       // Для превью
}
```

### 4. Кеширование (4 уровня)
- ✅ **ISR** - статическая генерация с обновлением каждые 10 минут
- ✅ **API кеш** - in-memory кеш для запросов к WooCommerce
- ✅ **HTTP кеш** - заголовки Cache-Control
- ✅ **Изображения** - кеш Next.js Image на 1 год

## 🔍 Как проверить работу WebP

### 1. В браузере (DevTools)
1. Откройте DevTools (F12)
2. Перейдите на вкладку **Network**
3. Обновите страницу
4. Найдите загруженные изображения
5. В колонке **Type** должно быть `webp`

### 2. URL изображений
Проверьте URL изображений в сети - они должны содержать параметр `f=webp`:
```
/_next/image?url=...&f=webp&q=75
```

### 3. Монитор производительности
В режиме разработки в правом нижнем углу отображается монитор:
- 📊 WebP Support: ✅ Yes
- 🖼️ Images Loaded: 12
- 🎯 WebP Images: 12 (100%)
- 📦 Total Size: 245 KB
- ⚡ Avg Load Time: 89 ms

### 4. Размер файлов
WebP изображения должны быть на 25-50% меньше оригинальных JPEG/PNG.

## 🎯 Ожидаемые результаты

| Метрика | До оптимизации | После оптимизации |
|---------|---------------|-------------------|
| Размер изображений | 100% | 50-75% |
| Скорость загрузки главной | ~6 секунд | ~1-2 секунды |
| LCP (Largest Contentful Paint) | >2.5s | <1.5s |
| CLS (Cumulative Layout Shift) | >0.1 | <0.1 |

## 🛠️ Устранение проблем

### Изображения не конвертируются в WebP
1. Проверьте, что используется `next/image`
2. Убедитесь, что `unoptimized: false` в `next.config.js`
3. Проверьте, что домен добавлен в `remotePatterns`

### Ошибки загрузки изображений
1. Проверьте CORS настройки на сервере изображений
2. Убедитесь, что сервер поддерживает WebP
3. Проверьте сетевые запросы в DevTools

### Медленная первая загрузка
1. Первый запрос создает и кеширует оптимизированное изображение
2. Последующие запросы будут мгновенными
3. Используйте `priority={true}` для важных изображений

## 📈 Мониторинг производительности

В production рекомендуется использовать:
- Google PageSpeed Insights
- Web Vitals extension
- Lighthouse CI
- Real User Monitoring (RUM)

## 🔧 Дополнительные настройки

### Для еще большей оптимизации:
```javascript
// next.config.js
images: {
  formats: ['image/webp'], // Только WebP
  minimumCacheTTL: 31536000, // 1 год кеш
  dangerouslyAllowSVG: false, // Отключить SVG если не нужно
}
```

### Для мобильных устройств:
```javascript
// Используйте более агрессивное сжатие
quality: 60 // вместо 75 для мобильных
``` 